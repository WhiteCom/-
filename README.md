# TowerDefense PathFinding

<타워디펜스 길찾기 로직 개선>

(결과물) - 좌 : 출발지 여러개일 떄 적 스폰 시 // 우 : 장애물 설치시 경로 변경

![출발경로가 여러개일때](https://user-images.githubusercontent.com/42011665/155678306-a6fd6706-227c-49fa-a4d3-0da6e36c5adc.png)


![경로 바꾸기](https://user-images.githubusercontent.com/42011665/155674574-ca4f63c9-c44e-4e3d-85fd-b6c65e3de10f.png)

![출발경로가 여러개일때](https://user-images.githubusercontent.com/42011665/155674594-11ff8aee-b0ee-4c90-8053-349d3cae89ae.png)


![이전 타워디펜스 포폴2](https://user-images.githubusercontent.com/42011665/155677951-8347ce60-6a71-4cf8-a833-52ef9950a604.png)

* 이전 게임 문제점

- 이전 길찾기 방식 : wayPoint(오브젝트)를 설치하여 배열에 담아 이동경로 구성
- 문제점
1) 장애물 설치 시 경로 못찾음. 
2) 2개 이상의 출발지에서 적 스폰시, 목표하는 경로로 가지 못하는 현상 발생

-----

<프로젝트 목표>
- 길찾기 알고리즘을 적용하여 타워디펜스 게임을 새롭게 만들어보자.


#2021.12.30 ~ 2022.02.20

- 1일차 : 기획 - 전체적인 구상
- 2일차 : 유니티 적응 (Sprite, TileMap, Script) -> 처음 : TileMap 사용, 나중 : Sprite 통한 순수 Script로 구현
- 3일차 : 타일 세팅 (가중치, 타입, 건설여부, 시작, 끝지점...) / 적 스폰 시스템 초안 작성
- 4일차 : 기획 - 적 생성시 풀메모리를 통해 구현 / 싱글톤을 통해 적 관리 매니저 작성
- 5일차 : 풀메모리(오브젝트 풀링) 구현 (Create, Allocate, Delete) / 길찾기 알고리즘을 어떻게 적용할까 고민 / 거리측정 방식 조사 (유클리드, 맨해튼)
- 6일차 : 코드 기획 - 다익스트라 알고리즘 적용 위해 배열 구상 / 적 움직임 구현위해 벡터 사용 / 유니티 라이프 사이클 조사 / 정렬, 자료구조 등 라이브러리의 필요성
- 7일차 : 코드 수정 = 설계가 잘못된 부분이 있어 GC가 계속 발생 / 우선순위 큐 클래스 생성하기 (최소힙)
- 8일차 : 다익스트라 알고리즘을 구현하고자 구상, 우선순위 큐(최소힙) 클래스 구현 / 인접 행렬 구성을 하기 위한 구상 / C++ 사고방식 -> C# 사고방식 전환 중
- 9일차 : 타일의 가중치에 따라 인접행렬 구성 / 다익스트라 알고리즘 메소드 구현
- 10일차 : 코드 수정 - 가중치 세팅 잘못 된 부분 / 스택을 이용하여 여러 최소경로 중 한 경로를 찾는 로직 구성
- 11일차 : 코드 수정 - 인접행렬 구하는 부분이 잘못 됨 / 다익스트라 알고리즘 부분 수정
- 12일차 : 코드 수정 - 스택을 이용한 부분에서 NullException 발생 (새롭게 오브젝트가 할당될 때 경로가 없어 NULL) / 유니티 라이프 사이클 및 Exception이 발생하는 것에 대해
- 13일차 : 적 animation 추가 (상하좌우 움직임)
- 14일차 : UI 작업 (라이프)
- 15일차 : UI 작업 (벽 설치 초기구상, 라이프 수정)
- 16일차 : UI 작업 (벽 설치) + 빌드 매니저 구현
- 17일차 : UI 작업 (버그 수정) + 실시간 길찾기 로직구상 (다익스트라)
- 18일차 : UI 작업 (종료 팝업창) + 실시간 길찾기 로직구상 (다익스트라)
- 19일차 : 실시간 길찾기 로직 개선
- 20일차 : 경로에 색깔 표시작업
- 21일차 : 개선된 길찾기 알고리즘 적용 구상 (다익스트라 -> A*)
- 22일차 : A* 공부 및 초기구현
- 23일차 : A* 버그수정
- 24일차 : 다익스트라, A* 성능 비교 
- 25일차 : 2개 이상의 출발지에서 스폰시 테스트


<개발하면서 많이 고민했던 부분들>

- 설계 부분 : 오브젝트 움직임 및 이벤트를 생각하여 타일 구상 (가중치, 타입, 건설가능 여부 등)
- 벡터 연산을 통한 움직임 구현 (두 벡터간의 차이를 이용)
- 풀메모리 구현 : 생성 - 할당 - 해제 (Unity 상에선 오브젝트 활성화 비활성화를 통해 간단히 구현)
- 다익스트라 알고리즘 구현을 위한 인접행렬 구성 (x, y 포지션 값과 가중치 값을 중심으로)
- 다익스트라 알고리즘 구현 (시작점으로 부터 방문 여부를 갱신해가면서 모든 정점간의 거리를 구한 뒤 최소거리 측정)
- 여러 최소경로 중 한 경로 선택하기 : 도착점을 기준으로 너비우선탐색을 통해 스택에 역순으로 push 하여 하나의 최소경로를 구함
- A* 알고리즘 적용 시 함수 구성 : F = G  + H // G : (이전->현재거리 + 타일가중치), H : (현재->도착점거리)

<보완해야 할 점>

- 효율성을 높일 수 있는 부분은 높이기 - 우선순위 큐 클래스화, 정렬로직 개선 등
- 다른 길찾기 알고리즘과의 비교
- 타워를 설치하여 게임처럼 만들어보기
- Exception 처리에 대해 좀 더 고민해보기
